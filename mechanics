#include <iostream>
#include "mechanics.h"

// Function: add scores and money to the user if he/she guesses correctly
// Input: the address of the user and a pointer to inventory 
// Output: scores and money added if the user guesses correctly
void correct(User &usr, int *p_inv) {
  int inc_money = usr.level * 50;
  int inc_score = usr.level * 100;

  if (p_inv[0]) {
    cout << "Money--> " << usr.money << " + " << inc_money << "\033[0;36m x 2\033[0m" << endl;
    inc_money *= 2;
  }
  if (!p_inv[0])
    cout << "Money--> " << usr.money << " + " << inc_money << endl;

  if (p_inv[1]) {
    cout << "Score--> " << usr.score << " + " << inc_score << "\033[0;36m x 2\033[0m" << endl;
    inc_score *= 2;
  }
  if (!p_inv[1])
    cout << "Score--> " << usr.score << " + " << inc_score << endl;

  usr.money += inc_money;
  usr.score += inc_score;
  usr.print_info();
}
// Function: 
// - the user will level up if he/she passes seven times consecutively 
// - the user can choose to continue or not
// Input: the address of the user and a pointer to inventory 
// Output: 
// - level up if the user passes seven times consecutively 
// - if the user chooses to continue: play is true and the game continues
// - if the user does not choose to continue: play is false and the game ends
bool levelUp(User &usr, int *p_inv) {
  cout << "\033[0;33mYou Win!\033[0m" << endl;

  cout << "Level--> " << usr.level << " + 1" << endl;
  usr.level++;
  usr.print_info();

  char choice;
  bool play;
  while (1) {
    cout << "Continue to play? [y/n]" << endl;
    cout << ">> ";
    cin >> choice;
    if (choice == 'y') {
      play = true;
      break;
    }
    else if (choice == 'n')
      play = false;
      break;
  }
  return play;
}
// Function: the game ends when the user guesses wrong unless he/she chooses to resurrect
// Input: the address of the user and result
// Output: 
// - if the user guesses wrong and choose to ressurect: resurrect is true and the game continues
// - if the user guesses wrong and do not choose to ressurect: resurrect is false and the game ends	
bool gameOver(User &usr, int result) {
  int amount = usr.level * 100 * result;
  bool resurrect;

  cout << "\033[0;31mGAME OVER.\033[0m" << endl;
  usr.print_info();
  while (1) {
    char option;
    cout << "Pay $ " << amount << " to resurrect? [y/n]" << endl; //player has to pay to resurrect
    cout << ">> ";
    cin >> option;

    if (option == 'y')
      if (usr.money < amount)
        cout << "\033[0;31m--Error: You don't have enough money.\033[0m" << endl; //player can't resurrect if he/she does not have enough money
      else {
        cout << "Money--> " << usr.money << " - " << amount << endl;
        usr.money -= amount;
        resurrect = true;
	usr.print_info();
        break;
      }
    else if (option == 'n') {
      usr.reset();
      cout << "Level--> 1" << endl;
      cout << "Score--> 0" << endl;
      resurrect = false;
      usr.print_info();
      break;
    }
  }

  return resurrect;
}

// Function: to guess the size of the next card
// Input: the size of the next card
// Output: 
// - if the size of the next card is same as the current card: result = 2 and the user has to pay double to resurrect 
// - if the size of the next card is guessed correctly: result is true and the game continues
// - if the size of the next card is not guessed correctly: result is false and the game ends
// - if the input is not correct: result = -1 and the user has to type again
int GuessSize(Card currentcard, Card nextcard) { 
  char choice;
  cout << "Press 'L' if you think the next card will be larger" << endl;
  cout << "Press 'S' if you think the next card will be smaller" << endl;
  cout << ">> ";
  cin >> choice;

  int result = 1;
  if (nextcard.rank_idx == currentcard.rank_idx)
      result = 2;
  else if (choice == 'S' && (nextcard.rank_idx < currentcard.rank_idx))
      result = 0;
  else if (choice == 'L' && (nextcard.rank_idx > currentcard.rank_idx))
      result = 0;
  else if (choice != 'S' && choice != 'L')
      result = -1;

  return result;
}
